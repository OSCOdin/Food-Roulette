<!DOCTYPE html>
<html>

<head>
    <style>
        #map {
            width: 50%;
            height: 400px;
            background-color: grey;
        }
    </style>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

</head>

<body>
    <h1> test yelp api </h1>
    <button id="test">test</button>

    <div id="map"></div>
    <script>
        var lat1 = 0;
        var lon1 = 0;


        // foodOptions = ["pizza", "chinese", "italian", "mexican", "thai", "burgers", "diners", "latin", "bbq", "pubs",
        //     "american", "tradamerican", "newamerican", "indian", "breakfast", "breakfast_brunch", "steakhouse"
        // ]

        function YelpCall() {
            const apiKey =
                'gMIHJxXUTxTdI3_v6Rnzo7uD3wZQcQ4sYrppHS3xRRGQM7iRvtaCPunKOB1auZmzlxJG2cvpmhPNc2WPRaxux6DYqUKT15Cxu_U5pF9bsOe--uerTHBNZ-x3LvXYW3Yx';
            const yelpUrl = 'https://api.yelp.com/v3/businesses/search?term=restaurants&latitude=' +
                lat1 + '&longitude=' + lon1 + '&limit=3';
            // const yelpUrl = 'https://api.yelp.com/v3/businesses/search?term=restaurants&location=${zipCode}&latitude&longitude';
            const proxyUrl = 'https://shielded-hamlet-43668.herokuapp.com/';
            $.ajax({
                    async: false,
                    url: proxyUrl + yelpUrl,
                    headers: {
                        authorization: 'Bearer ' + apiKey
                    }

                })
                .done(response => {
                    console.log(response)
                    response.businesses.forEach(function(businesses){
                        console.log(businesses)
                    })

                })
                .catch(error => {
                    console.error(error);

                });
        }

        var map, infoWindow;

        function initMap() {

            
            map = new google.maps.Map(
                document.getElementById('map'), {
                    zoom: 10,
                    center: {
                        lat: -34.397,
                        lng: 150.644
                    },
                });
            // The marker, positioned at Uluru
            // var marker1 = new google.maps.Marker({
            //     position: uluru,
            //     map: map
            // });
            // var marker2 = new google.maps.Marker({
            //     position: ulura,
            //     map: map
            // });
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    lat1 = position.coords.latitude;
                    lon1 = position.coords.longitude;
                    console.log(lat1, lon1)

                    // infoWindow.setPosition(pos.lat);
                    // infoWindow.setContent('Location found.');
                    // infoWindow.open(map);
                    map.setCenter(pos);
                    YelpCall();
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }

        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
        console.log(lat1, lon1)
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_uq660sOqIWpWFdN6tGwKUYR07jmx-Ww&callback=initMap">
    </script>
</body>

</html>